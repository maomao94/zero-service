<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocketIO 测试工具</title>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        /* 整体样式优化 */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f1f5f9;
            color: #1e293b;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        /* 容器样式 */
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* 标题样式 - 高级设计 */
        h1 {
            text-align: center;
            font-size: 2.8rem;
            font-weight: 700;
            color: white;
            margin: 0 auto 40px;
            padding: 30px 60px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 24px;
            box-shadow: 0 12px 48px rgba(99, 102, 241, 0.3), 0 4px 16px rgba(0,0,0,0.1);
            max-width: 800px;
            position: relative;
            overflow: hidden;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            letter-spacing: -0.5px;
            transition: all 0.3s ease;
        }
        
        /* 标题装饰效果 */
        h1::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }
        
        /* 浮动动画 */
        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-20px) rotate(180deg);
            }
        }
        
        /* 标题悬停效果 */
        h1:hover {
            transform: translateY(-2px);
            box-shadow: 0 16px 60px rgba(99, 102, 241, 0.4), 0 6px 24px rgba(0,0,0,0.15);
        }
        
        /* 主布局 - 调整比例，左侧固定宽度 */
        .main-layout {
            display: grid;
            grid-template-columns: 550px 1fr;
            gap: 24px;
            align-items: start;
        }
        
        /* 左侧控制面板 */
        .control-panel {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        
        /* 左侧控制面板 */
        .control-panel {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        
        /* 右侧日志区域 */
        .logs-panel {
            position: sticky;
            top: 20px;
            height: calc(100vh - 100px);
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 16px;
            box-shadow: 0 6px 24px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        /* 日志面板内的section */
        .logs-panel .section {
            height: 100%;
            display: flex;
            flex-direction: column;
            margin: 0;
            padding: 24px;
        }
        
        /* 清空日志按钮样式优化 */
        #clearLogsBtn {
            padding: 8px 16px !important;
            font-size: 12px !important;
            background: #f1f5f9 !important;
            color: #64748b !important;
            border: 1px solid #e2e8f0 !important;
            border-radius: 8px !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
        }
        
        #clearLogsBtn:hover {
            background: #e2e8f0 !important;
            color: #475569 !important;
        }
        
        /* 优化输入框样式 */
        input[type="text"], input[type="number"], select, textarea {
            transition: all 0.3s ease;
        }
        
        input[type="text"]:focus, input[type="number"]:focus, select:focus, textarea:focus {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        
        /* 优化按钮样式 */
        button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        /* 优化日志条目样式 */
        .log-entry {
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* 优化表格样式 */
        table {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }
        
        td {
            transition: all 0.2s ease;
        }
        
        tr:hover td {
            background-color: rgba(102, 126, 234, 0.08);
        }
        
        /* 优化状态指示器 */
        .status {
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        /* 卡片样式优化 - 顶部渐变条 */
        .section {
            position: relative;
            overflow: hidden;
            background: white;
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 24px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            border: 1px solid #f1f5f9;
        }
        
        /* 卡片顶部渐变装饰 */
        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 16px 16px 0 0;
        }
        
        /* 按钮样式统一优化 */
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        /* 按钮悬停效果 */
        button:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }
        
        /* 按钮激活效果 */
        button:active:not(:disabled) {
            transform: translateY(0);
        }
        
        /* 优化响应式布局 */
        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            
            .logs-panel {
                position: relative;
                height: 500px;
                top: 0;
            }
        }
        
        /* 标题样式优化 - 简约风格 */
        h1 {
            text-align: center;
            margin: 0 auto 30px;
            color: #2d3748;
            font-size: 2.4rem;
            font-weight: 700;
            padding: 16px 32px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            max-width: 700px;
        }
        
        /* 卡片样式优化 - 简约风格 */
        .section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.2s ease;
            border: 1px solid #e2e8f0;
        }
        
        .section:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }
        
        /* 子标题样式优化 - 简约风格 */
        h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #2d3748;
            font-weight: 600;
            position: relative;
            padding-bottom: 8px;
        }
        
        h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: #6366f1;
            border-radius: 2px;
        }
        
        /* 配置行样式优化 */
        .config-row {
            display: flex;
            gap: 20px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            align-items: end;
        }
        
        /* 表单组样式优化 */
        .form-group {
            flex: 1;
            min-width: 240px;
        }
        
        /* 标签样式优化 */
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 14px;
            color: #475569;
            letter-spacing: 0.3px;
            text-transform: uppercase;
        }
        
        /* 输入框样式优化 */
        input, select, textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background-color: #f8fafc;
            color: #1e293b;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background-color: white;
            transform: translateY(-1px);
        }
        
        /* 文本域特殊样式 */
        textarea {
            resize: vertical;
            min-height: 140px;
            font-family: inherit;
            line-height: 1.6;
        }
        
        /* 移除重复的输入框焦点样式 */
        
        /* 统一文本域样式 */
        textarea {
            resize: vertical;
            min-height: 140px;
            font-family: inherit;
            line-height: 1.6;
        }
        
        /* 按钮组样式优化 */
        .button-group {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            align-items: center;
            margin-top: 10px;
        }
        
        /* 按钮样式统一优化 */
        button {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }
        
        button:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        button.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        button.primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        }
        
        button.success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }
        
        button.success:hover:not(:disabled) {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
        }
        
        button.danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
        }
        
        button.danger:hover:not(:disabled) {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
        }
        
        button.secondary {
            background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
            color: white;
        }
        
        button.secondary:hover:not(:disabled) {
            background: linear-gradient(135deg, #718096 0%, #4a5568 100%);
        }
        
        .status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin-right: 12px;
        }
        
        .status::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .status.connected {
            background-color: rgba(72, 187, 120, 0.1);
            color: #38a169;
        }
        
        .status.connected::before {
            background-color: #48bb78;
        }
        
        .status.disconnected {
            background-color: rgba(245, 101, 101, 0.1);
            color: #e53e3e;
        }
        
        .status.disconnected::before {
            background-color: #f56565;
        }
        
        /* 日志容器样式优化 - 简约浅色主题 */
        #logs {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            overflow-y: auto;
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
            font-size: 13px;
            line-height: 1.6;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            color: #2d3748;
        }
        
        /* 滚动条样式优化 */
        #logs::-webkit-scrollbar {
            width: 8px;
        }
        
        #logs::-webkit-scrollbar-track {
            background: #f7fafc;
            border-radius: 4px;
        }
        
        #logs::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 4px;
        }
        
        #logs::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }
        
        /* 日志条目样式优化 */
        .log-entry {
            margin-bottom: 10px;
            padding: 14px 18px;
            border-radius: 8px;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }
        
        .log-entry:hover {
            transform: translateX(3px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        /* 日志条目类型样式 - 简约配色 */
        .log-entry.system {
            border-left-color: #6366f1;
            background: rgba(99, 102, 241, 0.05);
            color: #4f46e5;
        }
        
        .log-entry.connect {
            border-left-color: #22c55e;
            background: rgba(34, 197, 94, 0.05);
            color: #16a34a;
        }
        
        .log-entry.disconnect {
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.05);
            color: #dc2626;
        }
        
        .log-entry.message {
            border-left-color: #f59e0b;
            background: rgba(245, 158, 11, 0.05);
            color: #d97706;
        }
        
        .log-entry.receive {
            border-left-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.05);
            color: #7c3aed;
        }
        
        .log-entry.error {
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.08);
            color: #dc2626;
            font-weight: 600;
        }
        
        /* 时间戳样式优化 */
        .timestamp {
            color: #94a3b8;
            font-size: 11px;
            margin-right: 12px;
            font-weight: 600;
        }
        
        /* 开关样式 - 动态效果 */
        .switch input:checked + .slider {
            background-color: #6366f1;
        }
        
        .switch input:focus + .slider {
            box-shadow: 0 0 1px #6366f1;
        }
        
        .switch input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* 开关容器样式 */
        .switch-container {
            user-select: none;
        }
        
        .info {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #4a5568;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .info strong {
            color: #667eea;
            font-weight: 600;
        }
        
        .info code {
            background-color: rgba(102, 126, 234, 0.15);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 13px;
            color: #4c51bf;
        }
        
        .timestamp {
            color: #a0aec0;
            font-size: 11px;
            margin-right: 12px;
            font-weight: 600;
        }
        
        /* 表格样式 - 更现代的设计 */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        
        table:hover {
            box-shadow: 0 6px 24px rgba(0,0,0,0.12);
        }
        
        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        th {
            padding: 16px 20px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }
        
        td {
            padding: 14px 20px;
            border-bottom: 1px solid #f1f5f9;
            color: #475569;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        tbody tr {
            transition: all 0.3s ease;
            position: relative;
        }
        
        tbody tr:hover {
            background-color: rgba(102, 126, 234, 0.08);
            transform: translateX(4px);
        }
        
        tbody tr:hover td {
            color: #334155;
        }
        
        tbody tr td:last-child {
            text-align: right;
        }
        
        /* 移除按钮样式优化 */
        button.danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            transition: all 0.3s ease;
        }
        
        button.danger:hover:not(:disabled) {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.3);
        }
        
        /* 成功按钮样式优化 */
        button.success {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            transition: all 0.3s ease;
        }
        
        button.success:hover:not(:disabled) {
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.3);
        }
        
        /* 主按钮样式优化 */
        button.primary {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            transition: all 0.3s ease;
        }
        
        button.primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.3);
        }
        
        /* 次要按钮样式 */
        button.secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            transition: all 0.3s ease;
        }
        
        button.secondary:hover:not(:disabled) {
            background: linear-gradient(135deg, #475569 0%, #334155 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(100, 116, 139, 0.3);
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .section {
                padding: 16px;
            }
            
            .config-row {
                flex-direction: column;
                gap: 12px;
            }
            
            .form-group {
                min-width: auto;
            }
            
            .button-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            button {
                width: 100%;
            }
            
            #logs {
                height: 250px;
            }
        }
        
        /* 辅助样式 */
        .flex {
            display: flex;
        }
        
        .items-center {
            align-items: center;
        }
        
        .gap-2 {
            gap: 8px;
        }
        
        .gap-4 {
            gap: 16px;
        }
        
        .w-full {
            width: 100%;
        }
        
        .text-sm {
            font-size: 13px;
        }
        
        .font-medium {
            font-weight: 500;
        }
        
        .text-gray-500 {
            color: #a0aec0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SocketIO 消息网关测试工具</h1>
        
        <div class="main-layout">
            <!-- 左侧控制面板 -->
            <div class="control-panel">
                <!-- 连接配置 -->
                <div class="section">
                    <h2>连接配置</h2>
                    <div class="config-row">
                        <div class="form-group">
                            <label for="serverUrl">服务器URL</label>
                            <input type="text" id="serverUrl" value="http://localhost:11003" placeholder="http://your-server-url:port">
                        </div>
                    </div>
                    <div class="config-row" style="margin-top: 15px;">
                        <div class="form-group">
                            <label for="authToken">Authorization Token</label>
                            <input type="text" id="authToken" placeholder="Bearer token" style="width: 100%;">
                        </div>
                    </div>
                    <div class="button-group">
                        <button id="connectBtn" class="primary">连接</button>
            <button id="disconnectBtn" class="secondary" disabled>断开连接</button>
                        <span id="connectionStatus" class="status disconnected">未连接</span>
                        <span id="socketId"></span>
                    </div>
                </div>
                
                <!-- 消息发送 -->
                <div class="section">
                    <h2>消息发送</h2>
                    <div class="config-row">
                        <div class="form-group">
                            <label for="eventName">事件名称（广播时必填）</label>
                            <input type="text" id="eventName" value="custom_event" placeholder="例如：chat_message">
                        </div>
                        <div class="form-group">
                            <label for="broadcastRoomInput">房间名称（房间广播时必填）</label>
                            <input type="text" id="broadcastRoomInput" value="test-room" placeholder="房间名称">
                        </div>
                    </div>
                    <div class="form-group" style="margin-top: 15px;">
                        <label for="payload">消息内容（直接输入文本）</label>
                        <textarea id="payload" placeholder="输入要发送的消息内容">Hello SocketIO!</textarea>
                    </div>
                    <div class="button-group">
                <button id="sendUpBtn" class="primary">发送上行消息</button>
                <button id="sendRoomBtn" class="success">房间广播</button>
                <button id="sendGlobalBtn" class="success">全局广播</button>
            </div>
                </div>
                
                <!-- 房间管理 -->
                <div class="section">
                    <h2>房间管理</h2>
                    <div class="config-row">
                        <div class="form-group">
                            <label for="roomInput">房间名称</label>
                            <input type="text" id="roomInput" value="test-room" placeholder="room-name">
                        </div>
                    </div>
                    <div class="button-group">
                <button id="joinRoomBtn" class="success">加入房间</button>
                <button id="leaveRoomBtn" class="danger">离开房间</button>
            </div>
                </div>
                
                <!-- 事件监听 -->
                <div class="section">
                    <h2>事件监听</h2>
                    <div class="info">
                        <strong>说明：</strong>页面会自动监听系统事件，并支持动态添加/移除自定义事件监听：<br>
                        - <code>connect</code>: 连接成功<br>
                        - <code>disconnect</code>: 连接断开<br>
                        - <code>__down__</code>: 服务器响应消息<br>
                        - <code>__stat_down__</code>: 统计信息推送
                    </div>
                    
                    <!-- 新增事件监听 -->
                    <div class="config-row" style="margin-top: 15px;">
                        <div class="form-group">
                            <label for="newEventName">新增事件监听</label>
                            <div style="display: flex; gap: 10px;">
                            <input type="text" id="newEventName" placeholder="输入事件名称" style="flex: 1;">
                            <button id="addEventBtn" class="primary">添加监听</button>
                        </div>
                        </div>
                    </div>
                    
                    <!-- 事件列表表格 -->
                    <div style="margin-top: 15px;">
                        <label>已注册的事件监听器</label>
                        <table style="width: 100%; border-collapse: collapse; margin-top: 5px;">
                            <thead>
                                <tr style="background-color: #f2f2f2;">
                                    <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">事件名称</th>
                                    <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">状态</th>
                                    <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">操作</th>
                                </tr>
                            </thead>
                            <tbody id="eventTableBody">
                                <!-- 动态生成的事件列表 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- 右侧日志面板 -->
            <div class="logs-panel">
                <div class="section">
                    <h2>消息日志</h2>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div style="display: flex; gap: 16px; align-items: center;">
                            <!-- 现代化自动滚动开关 - 增强按钮颜色变化 -->
                            <label for="autoScrollCheck" style="display: flex; align-items: center; gap: 10px; font-size: 13px; font-weight: 500; color: #475569; cursor: pointer; user-select: none;">
                                <span>自动滚动</span>
                                <div style="position: relative; display: inline-block; cursor: pointer;">
                                    <input type="checkbox" id="autoScrollCheck" checked style="opacity: 0; position: absolute; left: 0; top: 0; width: 100%; height: 100%; cursor: pointer; margin: 0;">
                                    <div style="position: relative; width: 50px; height: 24px; background-color: #ef4444; border-radius: 25px; transition: all 0.3s ease; border: 2px solid #dc2626;"></div>
                                    <div style="position: absolute; top: 3px; left: 3px; width: 18px; height: 18px; background: white; border-radius: 50%; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); z-index: 2;"></div>
                                    <style>
                                        /* 关闭状态 - 红色主题 */
                                        #autoScrollCheck + div {
                                            background-color: #ef4444 !important;
                                            border-color: #dc2626 !important;
                                            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3) !important;
                                        }
                                        
                                        /* 开启状态 - 绿色主题 */
                                        #autoScrollCheck:checked + div {
                                            background-color: #10b981 !important;
                                            border-color: #059669 !important;
                                            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3) !important;
                                        }
                                        
                                        /* 滑块样式 */
                                        #autoScrollCheck + div + div {
                                            background: white !important;
                                            border: 1px solid #e2e8f0 !important;
                                        }
                                        
                                        /* 滑块位置 */
                                        #autoScrollCheck:checked + div + div {
                                            transform: translateX(26px) !important;
                                        }
                                    </style>
                                </div>
                            </label>
                            <select id="logFilter" style="padding: 8px 12px; font-size: 13px; border: 1px solid #e2e8f0; border-radius: 6px; background: white; color: #2d3748; cursor: pointer; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                                <option value="all">全部日志</option>
                                <option value="connect">连接状态</option>
                                <option value="message">发送消息</option>
                                <option value="receive">接收消息</option>
                                <option value="system">系统消息</option>
                                <option value="error">错误消息</option>
                            </select>
                        </div>
                        <button id="clearLogsBtn" class="secondary" style="padding: 8px 16px; font-size: 13px; background: #f7fafc; color: #4a5568; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; transition: all 0.2s ease;">清空日志</button>
                    </div>
                    <div id="logs" style="flex: 1; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 6px; padding: 12px; background: #fafafa; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 全局变量
        let socket = null;
        let isConnected = false;
        
        // DOM元素
        const serverUrlInput = document.getElementById('serverUrl');
        const authTokenInput = document.getElementById('authToken');
        const connectBtn = document.getElementById('connectBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const connectionStatus = document.getElementById('connectionStatus');
        const socketIdSpan = document.getElementById('socketId');
        const payloadInput = document.getElementById('payload');
        const sendUpBtn = document.getElementById('sendUpBtn');
        const sendRoomBtn = document.getElementById('sendRoomBtn');
        const sendGlobalBtn = document.getElementById('sendGlobalBtn');
        const broadcastRoomInput = document.getElementById('broadcastRoomInput');
        const roomInput = document.getElementById('roomInput');
        const joinRoomBtn = document.getElementById('joinRoomBtn');
        const leaveRoomBtn = document.getElementById('leaveRoomBtn');
        const logsDiv = document.getElementById('logs');
        
        // 广播相关元素
        const eventNameInput = document.getElementById('eventName');
        const clearLogsBtn = document.getElementById('clearLogsBtn');
        
        // 事件监听相关元素
        const newEventNameInput = document.getElementById('newEventName');
        const addEventBtn = document.getElementById('addEventBtn');
        const eventTableBody = document.getElementById('eventTableBody');
        
        // 已注册的自定义事件监听器集合
        const registeredEvents = new Set();
        
        // 从localStorage加载已注册的事件监听器
        function loadRegisteredEvents() {
            try {
                const savedEvents = localStorage.getItem('socketio_test_events');
                if (savedEvents) {
                    const events = JSON.parse(savedEvents);
                    events.forEach(eventName => {
                        registeredEvents.add(eventName);
                    });
                }
            } catch (error) {
                console.error('Failed to load registered events from localStorage:', error);
            }
        }
        
        // 保存已注册的事件监听器到localStorage
        function saveRegisteredEvents() {
            try {
                const events = Array.from(registeredEvents);
                localStorage.setItem('socketio_test_events', JSON.stringify(events));
            } catch (error) {
                console.error('Failed to save registered events to localStorage:', error);
            }
        }
        
        // 动态注册自定义事件监听器
        function registerCustomEventListener(eventName) {
            if (registeredEvents.has(eventName)) {
                return; // 已注册，跳过
            }
            
            // 注册监听器
            socket.on(eventName, (data) => {
                addLog('receive', `收到自定义事件 ${eventName}: ${JSON.stringify(data, null, 2)}`);
            });
            
            registeredEvents.add(eventName);
            saveRegisteredEvents(); // 保存到localStorage
            addLog('system', `已注册自定义事件监听器: ${eventName}`);
            updateEventTable(); // 更新事件列表
        }
        
        // 移除事件监听器
        function removeCustomEventListener(eventName) {
            if (!registeredEvents.has(eventName)) {
                return; // 未注册，跳过
            }
            
            // 移除监听器
            socket.off(eventName);
            
            registeredEvents.delete(eventName);
            saveRegisteredEvents(); // 保存到localStorage
            addLog('system', `已移除自定义事件监听器: ${eventName}`);
            updateEventTable(); // 更新事件列表
        }
        
        // 更新事件列表表格
        function updateEventTable() {
            // 清空表格
            eventTableBody.innerHTML = '';
            
            // 遍历已注册的事件
            for (const eventName of registeredEvents) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="border: 1px solid #ddd; padding: 8px;">${eventName}</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">已注册</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">
                        <button onclick="removeCustomEventListener('${eventName}')" class="danger" style="padding: 4px 8px; font-size: 12px;">移除</button>
                    </td>
                `;
                eventTableBody.appendChild(row);
            }
            
            // 如果没有注册事件，显示空状态
            if (registeredEvents.size === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="3" style="border: 1px solid #ddd; padding: 12px; text-align: center; color: #999;">暂无自定义事件监听器</td>`;
                eventTableBody.appendChild(row);
            }
        }
        
        // 清空日志
        function clearLogs() {
            logsDiv.innerHTML = '';
            addLog('system', '日志已清空');
        }
        
        // 绑定清空日志事件
        clearLogsBtn.addEventListener('click', clearLogs);
        
        // 绑定添加事件监听按钮
        addEventBtn.addEventListener('click', () => {
            const eventName = newEventNameInput.value.trim();
            if (!eventName) {
                addLog('error', '事件名称不能为空');
                return;
            }
            
            if (!isConnected) {
                addLog('error', '请先连接服务器');
                return;
            }
            
            registerCustomEventListener(eventName);
            newEventNameInput.value = ''; // 清空输入框
        });
        
        // 绑定回车键添加事件监听
        newEventNameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addEventBtn.click();
            }
        });
        
        // 生成唯一请求ID
        function generateReqId() {
            return 'req-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        }
        
        // 添加日志
        function addLog(type, message) {
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            logEntry.innerHTML = `<span class="timestamp">${timestamp}</span>${message}`;
            logsDiv.appendChild(logEntry);
            
            // 限制日志条数，最多保留100条
            const logEntries = logsDiv.querySelectorAll('.log-entry');
            if (logEntries.length > 100) {
                // 删除最早的日志条目
                logsDiv.removeChild(logEntries[0]);
            }
            
            // 自动滚动到底部（如果启用）
            if (document.getElementById('autoScrollCheck').checked) {
                logsDiv.scrollTop = logsDiv.scrollHeight;
            }
            
            // 应用日志过滤
            applyLogFilter();
        }
        
        // 应用日志过滤
        function applyLogFilter() {
            const filterValue = document.getElementById('logFilter').value;
            const logEntries = logsDiv.querySelectorAll('.log-entry');
            
            logEntries.forEach(entry => {
                if (filterValue === 'all') {
                    entry.style.display = 'block';
                } else {
                    const entryType = entry.className.split(' ')[1];
                    if (entryType === filterValue) {
                        entry.style.display = 'block';
                    } else {
                        entry.style.display = 'none';
                    }
                }
            });
        }
        
        // 绑定日志过滤事件
        document.getElementById('logFilter').addEventListener('change', applyLogFilter);
        
        // 连接
        function connect() {
            const serverUrl = serverUrlInput.value;
            const authToken = authTokenInput.value.trim();
            
            addLog('system', `正在连接到 ${serverUrl}...`);

            const socketOptions = {
                transports: ['websocket'],
                reconnection: true,
            };
            
            if (authToken) {
                socketOptions.query = {
                    ticket: authToken
                };
                socketOptions.auth = {
                    token: authToken
                };
                addLog('system', `使用query选项传递ticket参数: ${authToken}`);
            }
            
            socket = io(serverUrl, socketOptions);

            socket.io.on("ping", () => {
                addLog('system', '收到服务器ping包');
            });

            // 监听连接事件
            socket.on('connect', () => {
                isConnected = true;
                updateConnectionStatus();
                addLog('connect', `连接成功，Socket ID: ${socket.id}`);
                socketIdSpan.textContent = `Socket ID: ${socket.id}`;
                
                // 注册默认的自定义事件监听器
                const defaultEventName = eventNameInput.value;
                registerCustomEventListener(defaultEventName);
                
                // 重新注册所有已保存的事件监听器
                registeredEvents.forEach(eventName => {
                    socket.on(eventName, (data) => {
                        addLog('receive', `收到自定义事件 ${eventName}: ${JSON.stringify(data, null, 2)}`);
                    });
                });
                
                updateEventTable(); // 更新事件列表
            });
            
            // 事件名称输入框变化时，注册新的监听器
            eventNameInput.addEventListener('change', () => {
                const eventName = eventNameInput.value;
                if (eventName && isConnected) {
                    registerCustomEventListener(eventName);
                }
            });
            
            // 监听断开事件
            socket.on('disconnect', (reason) => {
                isConnected = false;
                updateConnectionStatus();
                addLog('disconnect', `连接断开，原因: ${reason}`);
                socketIdSpan.textContent = '';
            });
            
            // 监听错误事件
            socket.on('connect_error', (error) => {
                addLog('error', `连接错误: ${error.message}`);
            });
            
            // 监听__down__事件
            socket.on('__down__', (data) => {
                addLog('receive', `收到__down__事件: ${JSON.stringify(data, null, 2)}`);
            });
            
            // 监听__stat_down__事件
            socket.on('__stat_down__', (data) => {
                addLog('receive', `收到__stat_down__事件: ${JSON.stringify(data, null, 2)}`);
            });
        }
        
        // 断开连接
        function disconnect() {
            if (socket) {
                socket.disconnect();
                socket = null;
            }
        }
        
        // 更新连接状态
        function updateConnectionStatus() {
            if (isConnected) {
                connectionStatus.className = 'status connected';
                connectionStatus.textContent = '已连接';
                connectBtn.disabled = true;
                disconnectBtn.disabled = false;
            } else {
                connectionStatus.className = 'status disconnected';
                connectionStatus.textContent = '未连接';
                connectBtn.disabled = false;
                disconnectBtn.disabled = true;
            }
        }
        
        // 发送上行消息
        function sendUp() {
            if (!isConnected) {
                addLog('error', '请先连接服务器');
                return;
            }
            
            const payload = payloadInput.value;
            const reqId = generateReqId();
            
            // 发送__up__事件，按照文档要求格式
            socket.emit('__up__', {
                payload: payload,  // 业务数据，JSON字符串格式
                reqId: reqId        // 请求唯一标识
            }, (ack) => {
                addLog('message', `收到ACK回调: ${JSON.stringify(ack, null, 2)}`);
            });
            
            addLog('message', `发送__up__事件: ${JSON.stringify({ payload: payload, reqId: reqId }, null, 2)}`);
        }
        
        // 发送房间广播
        function sendRoom() {
            if (!isConnected) {
                addLog('error', '请先连接服务器');
                return;
            }
            
            const payload = payloadInput.value;
            const reqId = generateReqId();
            const room = broadcastRoomInput.value;
            const eventName = eventNameInput.value;
            
            // 注册自定义事件监听器
            registerCustomEventListener(eventName);
            
            // 发送__room_broadcast_up__事件，使用用户输入的事件名称
            socket.emit('__room_broadcast_up__', {
                payload: payload,  // 业务数据，JSON字符串格式
                reqId: reqId,      // 请求唯一标识
                room: room,        // 房间名称
                event: eventName   // 自定义事件名称
            }, (ack) => {
                addLog('message', `收到房间广播ACK: ${JSON.stringify(ack, null, 2)}`);
            });
            
            addLog('message', `发送房间广播到 ${room}，事件: ${eventName}: ${JSON.stringify({ payload: payload, reqId: reqId, event: eventName }, null, 2)}`);
        }
        
        // 发送全局广播
        function sendGlobal() {
            if (!isConnected) {
                addLog('error', '请先连接服务器');
                return;
            }
            
            const payload = payloadInput.value;
            const reqId = generateReqId();
            const eventName = eventNameInput.value;
            
            // 注册自定义事件监听器
            registerCustomEventListener(eventName);
            
            // 发送__global_broadcast_up__事件，使用用户输入的事件名称
            socket.emit('__global_broadcast_up__', {
                payload: payload,  // 业务数据，JSON字符串格式
                reqId: reqId,      // 请求唯一标识
                event: eventName   // 自定义事件名称
            }, (ack) => {
                addLog('message', `收到全局广播ACK: ${JSON.stringify(ack, null, 2)}`);
            });
            
            addLog('message', `发送全局广播，事件: ${eventName}: ${JSON.stringify({ payload: payload, reqId: reqId, event: eventName }, null, 2)}`);
        }
        
        // 加入房间
        function joinRoom() {
            if (!isConnected) {
                addLog('error', '请先连接服务器');
                return;
            }
            
            const room = roomInput.value;
            const reqId = generateReqId();
            
            // 发送__join_room_up__事件
            socket.emit('__join_room_up__', {
                reqId: reqId,
                room: room
            }, (ack) => {
                addLog('message', `收到加入房间ACK: ${JSON.stringify(ack, null, 2)}`);
            });
            
            addLog('message', `正在加入房间: ${room}`);
        }
        
        // 离开房间
        function leaveRoom() {
            if (!isConnected) {
                addLog('error', '请先连接服务器');
                return;
            }
            
            const room = roomInput.value;
            const reqId = generateReqId();
            
            // 发送__leave_room_up__事件
            socket.emit('__leave_room_up__', {
                reqId: reqId,
                room: room
            }, (ack) => {
                addLog('message', `收到离开房间ACK: ${JSON.stringify(ack, null, 2)}`);
            });
            
            addLog('message', `正在离开房间: ${room}`);
        }
        
        // 更新连接状态
        function updateConnectionStatus() {
            if (isConnected) {
                connectionStatus.className = 'status connected';
                connectionStatus.textContent = '已连接';
                connectBtn.disabled = true;
                disconnectBtn.disabled = false;
                sendUpBtn.disabled = false;
                sendRoomBtn.disabled = false;
                sendGlobalBtn.disabled = false;
                joinRoomBtn.disabled = false;
                leaveRoomBtn.disabled = false;
            } else {
                connectionStatus.className = 'status disconnected';
                connectionStatus.textContent = '未连接';
                connectBtn.disabled = false;
                disconnectBtn.disabled = true;
                sendUpBtn.disabled = true;
                sendRoomBtn.disabled = true;
                sendGlobalBtn.disabled = true;
                joinRoomBtn.disabled = true;
                leaveRoomBtn.disabled = true;
            }
        }
        
        // 绑定事件监听器
        connectBtn.addEventListener('click', connect);
        disconnectBtn.addEventListener('click', disconnect);
        sendUpBtn.addEventListener('click', sendUp);
        sendRoomBtn.addEventListener('click', sendRoom);
        sendGlobalBtn.addEventListener('click', sendGlobal);
        joinRoomBtn.addEventListener('click', joinRoom);
        leaveRoomBtn.addEventListener('click', leaveRoom);
        
        // 初始化状态
        loadRegisteredEvents(); // 从localStorage加载已注册的事件
        updateConnectionStatus();
        updateEventTable(); // 更新事件列表表格
        addLog('system', 'SocketIO测试工具已初始化，等待连接...');
    </script>
</body>
</html>