syntax = "proto3";

package socketpush;
option go_package = "./socketpush";
option java_multiple_files = true;
option java_package = "com.github.socketpush.grpc";
option java_outer_classname = "SocketPushProto";

service SocketPush {
  // 生成token
  rpc GenToken (GenTokenReq) returns (GenTokenRes);
  // 验证token
  rpc VerifyToken (VerifyTokenReq) returns (VerifyTokenRes);
  // 加入房间
  rpc JoinRoom(JoinRoomReq) returns (JoinRoomRes);
  // 离开房间
  rpc LeaveRoom(LeaveRoomReq) returns (LeaveRoomRes);
  // 向指定房间广播消息
  rpc BroadcastRoom(BroadcastRoomReq) returns (BroadcastRoomRes);
  // 向所有在线前端广播消息
  rpc BroadcastGlobal(BroadcastGlobalReq) returns (BroadcastGlobalRes);
  // 剔除 session
  rpc KickSession(KickSessionReq) returns (KickSessionRes);
  // 指定元数据剔除 session
  rpc KickMetaSession(KickMetaSessionReq) returns (KickMetaSessionRes);
  // 向指定 session 发送消息
  rpc SendToSession(SendToSessionReq) returns (SendToSessionRes);
  // 向指定 session 批量发送消息
  rpc SendToSessions(SendToSessionsReq) returns (SendToSessionsRes);
  // 向指定元数据 session 发送消息
  rpc SendToMetaSession(SendToMetaSessionReq) returns (SendToMetaSessionRes);
  // 向指定元数据 session 批量发送消息
  rpc SendToMetaSessions(SendToMetaSessionsReq) returns (SendToMetaSessionsRes);
  // 获取网关统计信息
  rpc SocketGtwStat(SocketGtwStatReq) returns (SocketGtwStatRes);
}

message PbMetaSession{
  string key = 1;
  string value = 2;
}

message PbSocketGtwStat{
  string node = 1;
  int64 sessions = 2;
}

message GenTokenReq{
  string uid = 1;
  map<string, string> payload = 2;
}

message GenTokenRes{
  string accessToken = 1;
  int64  accessExpire = 2;
  int64  refreshAfter = 3;
}

message VerifyTokenReq{
  string accessToken = 1;
}

message VerifyTokenRes{
  string claim_json = 1;
}

message JoinRoomReq {
  string reqId = 1;
  string sId = 2;    // session ID
  string room = 3;   // 房间名
}

message JoinRoomRes {
  string reqId = 1;
}

message LeaveRoomReq {
  string reqId = 1;
  string sId = 2;
  string room = 3;
}

message LeaveRoomRes {
  string reqId = 1;
}

message BroadcastRoomReq {
  string reqId = 1;
  string room = 2;
  string event = 3;
  string payload = 4;
}

message BroadcastRoomRes {
  string reqId = 1;
}

message BroadcastGlobalReq {
  string reqId = 1;
  string event = 2;
  string payload = 3;
}

message BroadcastGlobalRes {
  string reqId = 1;
}

message KickSessionReq {
  string reqId = 1;
  string sId = 2;
}

message KickSessionRes {
  string reqId = 1;
}

message KickMetaSessionReq {
  string reqId = 1;
  string key = 2;
  string value = 3;
}

message KickMetaSessionRes {
  string reqId = 1;
}

message SendToSessionReq {
  string reqId = 1;
  string sId = 2;
  string event = 3;
  string payload = 4;
}

message SendToSessionRes {
  string reqId = 1;
}

message SendToSessionsReq {
  string reqId = 1;
  repeated string sIds = 2;
  string event = 3;
  string payload = 4;
}

message SendToSessionsRes {
  string reqId = 1;
}

message SendToMetaSessionReq {
  string reqId = 1;
  string key = 2;
  string value = 3;
  string event = 4;
  string payload = 5;
}

message SendToMetaSessionRes {
  string reqId = 1;
}

message SendToMetaSessionsReq {
  string reqId = 1;
  repeated PbMetaSession metaSessions = 2;
  string event = 3;
  string payload = 4;
}

message SendToMetaSessionsRes {
  string reqId = 1;
}

message SocketGtwStatReq {
}

message SocketGtwStatRes {
  repeated PbSocketGtwStat stats = 1;
}