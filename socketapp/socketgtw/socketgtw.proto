syntax = "proto3";

package socketgtw;
option go_package = "./socketgtw";
option java_multiple_files = true;
option java_package = "com.github.socketgtw.grpc";
option java_outer_classname = "SocketGtwProto";

service SocketGtw {
  // 加入房间
  rpc JoinRoom(JoinRoomReq) returns (JoinRoomRes);
  // 离开房间
  rpc LeaveRoom(LeaveRoomReq) returns (LeaveRoomRes);
  // 向指定房间广播消息
  rpc BroadcastRoom(BroadcastRoomReq) returns (BroadcastRoomRes);
  // 向所有在线前端广播消息
  rpc BroadcastGlobal(BroadcastGlobalReq) returns (BroadcastGlobalRes);
  // 剔除 session
  rpc KickSession(KickSessionReq) returns (KickSessionRes);
  // 指定元数据剔除 session
  rpc KickMetaSession(KickMetaSessionReq) returns (KickMetaSessionRes);
  // 向指定 session 发送消息
  rpc SendToSession(SendToSessionReq) returns (SendToSessionRes);
  // 向指定 session 批量发送消息
  rpc SendToSessions(SendToSessionsReq) returns (SendToSessionsRes);
  // 向指定元数据 session 发送消息
  rpc SendToMetaSession(SendToMetaSessionReq) returns (SendToMetaSessionRes);
  // 向指定元数据 session 批量发送消息
  rpc SendToMetaSessions(SendToMetaSessionsReq) returns (SendToMetaSessionsRes);
}

message PbMetaSession{
  string key = 1;
  string value = 2;
}

message JoinRoomReq {
  string reqId = 1;
  string sId = 2;    // session ID
  string room = 3;   // 房间名
}

message JoinRoomRes {
  string reqId = 1;
}

message LeaveRoomReq {
  string reqId = 1;
  string sId = 2;
  string room = 3;
}

message LeaveRoomRes {
  string reqId = 1;
}

message BroadcastRoomReq {
  string reqId = 1;
  string room = 2;
  string event = 3;
  string payload = 4;
}

message BroadcastRoomRes {
  string reqId = 1;
}

message BroadcastGlobalReq {
  string reqId = 1;
  string event = 2;
  string payload = 3;
}

message BroadcastGlobalRes {
  string reqId = 1;
}

message KickSessionReq {
  string reqId = 1;
  string sId = 2;
}

message KickSessionRes {
  string reqId = 1;
}

message KickMetaSessionReq {
  string reqId = 1;
  string key = 2;
  string value = 3;
}

message KickMetaSessionRes {
  string reqId = 1;
}

message SendToSessionReq {
  string reqId = 1;
  string sId = 2;
  string event = 3;
  string payload = 4;
}

message SendToSessionRes {
  string reqId = 1;
}

message SendToSessionsReq {
  string reqId = 1;
  repeated string sIds = 2;
  string event = 3;
  string payload = 4;
}

message SendToSessionsRes {
  string reqId = 1;
}

message SendToMetaSessionReq {
  string reqId = 1;
  string key = 2;
  string value = 3;
  string event = 4;
  string payload = 5;
}

message SendToMetaSessionRes {
  string reqId = 1;
}

message SendToMetaSessionsReq {
  string reqId = 1;
  repeated PbMetaSession metaSessions = 2;
  string event = 3;
  string payload = 4;
}

message SendToMetaSessionsRes {
  string reqId = 1;
}